<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - Nutrition App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@100;200;300;400;500;600;700;800;900&family=Inter:wght@100;200;300;400;500;600;700;800;900&family=Newsreader:ital,opsz,wght@0,6..72,200;0,6..72,300;0,6..72,400;0,6..72,500;0,6..72,600;0,6..72,700;0,6..72,800;1,6..72,200;1,6..72,300;1,6..72,400;1,6..72,500;1,6..72,600;1,6..72,700;1,6..72,800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .profile-container {
            min-height: 100vh;
            background-color: var(--light-accent);
            padding: 50px 0;
        }
        
        .profile-card {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0px 0px 17px 0px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--mid-accent);
        }
        
        .profile-title {
            color: var(--main-color);
            text-align: center;
            font-size: 3rem;
            margin-bottom: 30px;
            font-family: 'Newsreader', serif;
        }
        
        .nav-link-custom {
            color: var(--main-color);
            text-decoration: none;
            font-family: 'Be Vietnam Pro', sans-serif;
            margin-bottom: 20px;
            display: inline-block;
        }
        
        .nav-link-custom:hover {
            color: var(--dark-accent);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="dashboard.html">
                <img src="/placeholder.svg?height=60&width=60" alt="Logo" id="nav-logo">
                <img src="/placeholder.svg?height=40&width=120" alt="Brand" class="logo-text">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="dashboard.html">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="search-history.html">History</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="logout()">Logout</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="profile-container">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <a href="dashboard.html" class="nav-link-custom">‚Üê Back to Dashboard</a>
                    <div class="profile-card">
                        <h1 class="profile-title">Edit Profile</h1>
                        <form id="profileForm" class="form">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="input-field">
                                        <label for="firstName" class="form-label">First Name</label>
                                        <input type="text" class="form-control" id="firstName" name="firstName">
                                    </div>
                                    <div class="input-field">
                                        <label for="lastName" class="form-label">Last Name</label>
                                        <input type="text" class="form-control" id="lastName" name="lastName">
                                    </div>
                                    <div class="input-field">
                                        <label for="age" class="form-label">Age</label>
                                        <input type="number" class="form-control" id="age" name="age" min="1" max="120">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input-field">
                                        <label for="weight" class="form-label">Weight (kg)</label>
                                        <input type="number" class="form-control" id="weight" name="weight" step="0.1" min="1">
                                    </div>
                                    <div class="input-field">
                                        <label for="height" class="form-label">Height (cm)</label>
                                        <input type="number" class="form-control" id="height" name="height" min="1">
                                    </div>
                                    <div class="input-field">
                                        <label class="form-label">Activity Level</label>
                                        <div class="range-subheadings">
                                            <span>Sedentary</span>
                                            <span style="float: right;">Very Active</span>
                                        </div>
                                        <input type="range" class="form-range" id="activityLevel" name="activityLevel" min="1" max="5" value="3">
                                        <div class="text-center mt-2">
                                            <span id="activityLevelText">Moderate</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="input-field">
                                <label class="form-label">Diet Type</label>
                                <div id="diet-radio">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="dietType" id="omnivore" value="omnivore">
                                        <label class="form-check-label" for="omnivore">Omnivore</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="dietType" id="vegetarian" value="vegetarian">
                                        <label class="form-check-label" for="vegetarian">Vegetarian</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="dietType" id="vegan" value="vegan">
                                        <label class="form-check-label" for="vegan">Vegan</label>
                                    </div>
                                </div>
                            </div>
                            <div class="text-center">
                                <button type="submit" class="btn btn-success form-button">Update Profile</button>
                            </div>
                            <div id="message" class="mt-3" style="display: none;"></div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Activity level text mapping
        const activityLevels = {
            1: 'Sedentary',
            2: 'Lightly Active',
            3: 'Moderate',
            4: 'Very Active',
            5: 'Extremely Active'
        };

        // Update activity level text
        document.getElementById('activityLevel').addEventListener('input', function() {
            document.getElementById('activityLevelText').textContent = activityLevels[this.value];
        });

        // Load profile data
        async function loadProfile() {
            try {
                const response = await fetch('/api/profile');
                if (response.ok) {
                    const profile = await response.json();
                    
                    document.getElementById('firstName').value = profile.first_name || '';
                    document.getElementById('lastName').value = profile.last_name || '';
                    document.getElementById('age').value = profile.age || '';
                    document.getElementById('weight').value = profile.weight || '';
                    document.getElementById('height').value = profile.height || '';
                    
                    if (profile.activity_level) {
                        document.getElementById('activityLevel').value = profile.activity_level;
                        document.getElementById('activityLevelText').textContent = activityLevels[profile.activity_level];
                    }
                    
                    if (profile.diet_type) {
                        document.getElementById(profile.diet_type).checked = true;
                    }
                } else {
                    window.location.href = '/login.html';
                }
            } catch (error) {
                console.error('Error loading profile:', error);
            }
        }

        // Save profile
        document.getElementById('profileForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = {
                firstName: formData.get('firstName'),
                lastName: formData.get('lastName'),
                age: formData.get('age'),
                weight: formData.get('weight'),
                height: formData.get('height'),
                activityLevel: formData.get('activityLevel'),
                dietType: formData.get('dietType')
            };
            
            try {
                const response = await fetch('/api/profile', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                const messageDiv = document.getElementById('message');
                
                if (result.success) {
                    messageDiv.className = 'alert alert-success text-center';
                    messageDiv.textContent = 'Profile updated successfully!';
                } else {
                    messageDiv.className = 'alert alert-danger text-center';
                    messageDiv.textContent = result.error || 'Failed to update profile';
                }
                
                messageDiv.style.display = 'block';
                setTimeout(() => {
                    messageDiv.style.display = 'none';
                }, 3000);
            } catch (error) {
                console.error('Error updating profile:', error);
                const messageDiv = document.getElementById('message');
                messageDiv.className = 'alert alert-danger text-center';
                messageDiv.textContent = 'Failed to update profile';
                messageDiv.style.display = 'block';
            }
        });

        // Logout function
        async function logout() {
            try {
                await fetch('/api/logout', { method: 'POST' });
                window.location.href = '/login.html';
            } catch (error) {
                console.error('Logout error:', error);
                window.location.href = '/login.html';
            }
        }

        // Load profile on page load
        loadProfile();
    </script>
</body>
</html>
